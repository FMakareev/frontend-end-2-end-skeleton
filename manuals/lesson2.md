# nightwatchjs: пишем простой тест.

## План

0. Постановка цели
1. Описание теста
2. Реализация теста.

## Постановка целию

Тестировать будем сайт [google](https://google.com). 

Вот наш первый кейс для тестирования:

Когда мы вводим в поиске слово `nightwatchjs` нажимаем отправить в поисковой выдаче должен быть такой текст `nightwatchjs.org/`

Приступим.

## Описание теста.

Прежде чем начать кодировать давайте распишим алгоритм который далее реализуем.
С чего начать? 

1. Перейти по ссылке на страницу
2. Дождатся полной загрузки страницы
3. Найти на странице поле для ввода поискового запроса
4. Ввести в это поле текст
5. Вызвать отправку введенных данных
6. Дождатся появления результатов поиска
7. Найти на странице элемент в котором мы ожидаем найти наш текст
8. проверяем есть ли в этом элементе текст
9. Завершаем тест.

> Вроди бы не сложно и вы скажите что-то вроди "Да я и сам меньше чем за минуту это проверю" 
и будете правы но в условиях когда проект постоянно развивается вам приходится проверять руками такой кейс после 
каждого деплоя на сервер, а таких кейсов даже не десятки. Уловили мысль?

Приступим к реализации.

## Реализация теста

Создайте в директории `tests` файл например с таким названием `searchgoogle.js` и запишите в него следующее:

```js
module.exports = {
    'Google search nightwatchjs': browser => {
        
    }
}
```

Так что тут происходит? 

* `module.exports` - отвечает за экспорт наших тестов, 
* `'Google search nightwatchjs'` - это название нашего теста, оно должно быть уникальным и отражать суть того что в нем происходит.
* browser - это объект предоставляющий нам доступ к методам управления браузером.

Теперь пойдем по пунктам реализовывая алгоритм.

### 1. Перейти по ссылке на страницу

Для открытия браузера с определенным адресом нужно выполнить команду [url('{address}')](http://nightwatchjs.org/api/url.html), 
где `address` - это адрес сайта.

```js
module.exports = {
    'Demo test Google' : function (browser) {
        browser
            .url('http://www.google.com')
    }
};
``` 

### 2. Дождатся полной загрузки страницы


Прежде чем начать взаимодействовать с DOM деревом нам нужно дождатся его появления, для этого используется метод 
[waitForElementVisible(selector)](http://nightwatchjs.org/api/waitForElementVisible.html), 
где `selector` - это название элемента появление которого мы ожидаем прежде чем продолжить выполнять тест.
    
```js
module.exports = {
    'Demo test Google' : function (browser) {
        browser
            .url('http://www.google.com')
            .waitForElementVisible('body')
    }
};
``` 

Мы можем передать в `waitForElementVisible` любой DOM элемент но на этом этапе достаточно указать body, 
хотя в дальнейшем когда вы будете писать тесты для своих проектов учитывайте их спицифику, 
возможно вам будет недостаточно просто подождать появления тега body и нужно указать более точное значение.

### 3. Найти на странице поле для ввода поискового запроса и 4. Ввести в это поле текст
    
Для поиска на странице поля для ввода и записи в него каких либо данных используется метод 
[setValue(selector, inputValue)](http://nightwatchjs.org/api/setValue.html), 
где `selector` - это css селектор по которому будет осуществлен поиск в DOM дереве, `inputValue` - это текст который будет записан в поле ввода. 
    
```js
module.exports = {
    'Demo test Google' : function (browser) {
        browser
            .url('http://www.google.com')
            .waitForElementVisible('body')
            .setValue('input[type=text]', 'nightwatch')
    }
};
``` 

Где взять значение для `selector`? Для этого вы можете либо уточнить у своих разработчиков названия селекторов разных 
элементов которые будете использовать в тестах или же с помощью инструментов разработчика в раузере найти нужные идентификаторы. 
Иногда этих идентификаторов может и не быть и тогда вам не к чему будет прицепится, в таких случаях просите разработчиков добавлять 
на нужные вам элементы.


### 5. Вызвать отправку введенных данных

После того как мы ввели наш текст для запроса необходимо его отправить но для начала стоит проверить, а есть ли на странице кнопка для этого? 
За это отвечает так же метод [waitForElementVisible(selector)](http://nightwatchjs.org/api/waitForElementVisible.html) описаный на втором шаге. 
Когда мы убедились что он есть выполняем метод [.click(selector)](http://nightwatchjs.org/api/click.html), 
где `selector` - это css селектор по которому будет осуществлен поиск в DOM дереве. Этот метод находит нужным нам эелемент и нажимает на него.

```js
module.exports = {
    'Demo test Google' : function (browser) {
        browser
            .url('http://www.google.com')
            .waitForElementVisible('body')
            .setValue('input[type=text]', 'nightwatch')
            .waitForElementVisible('input[name=btnK]')
            .click('input[name=btnK]')
    }
};
``` 

### 6. Дождатся появления результатов поиска

Тут все просто, мы можем поставить выполнение теста на паузу при этом в браузере не завершенные действия напирем переход по ссылке будут выполнятся. 
За это отвечает метод [.pause(ms)](http://nightwatchjs.org/api/pause.html), где `ms` - колличество милисекунд. Этот метод можно так же использовать для
дебага тестов чтобы проверять что проивходит при выполнение тех или иных методов.

```js
module.exports = {
    'Demo test Google' : function (browser) {
        browser
            .url('http://www.google.com')
            .waitForElementVisible('body')
            .setValue('input[type=text]', 'nightwatch')
            .waitForElementVisible('input[name=btnK]')
            .click('input[name=btnK]')
            .pause(1000)
    }
};
``` 

### 7. Найти на странице элемент в котором мы ожидаем найти наш текст, 8. проверяем есть ли в этом элементе текст, 9. Завершаем тест.

На этом этапе мы используем сразу несколько методов, первый это [assert](http://nightwatchjs.org/api/#assertions). 
`assert` проверяет если условие не выполнено то тест проваливается. В нем есть ряд методов для проверок, в нашем случае подходит метод
[containsText(cssSelector, expectedText)](http://nightwatchjs.org/api/#assert-containsText), 
где `cssSelector` - это css селектор по которому будет выполнен поиск, 
`expectedText` - это текст который бдет и nightwatch будет искать в казаном элементе.
Затем мы вызывам метод [end()](http://nightwatchjs.org/api/end.html) он закрывает сессию браузера.

```js
module.exports = {
    'Demo test Google' : function (browser) {
        browser
            .url('http://www.google.com')
            .waitForElementVisible('body')
            .setValue('input[type=text]', 'nightwatch')
            .waitForElementVisible('input[name=btnK]')
            .click('input[name=btnK]')
            .pause(1000)
            .assert.containsText('#main', 'nightwatchjs.org/')
            .end();
    }
};
``` 
