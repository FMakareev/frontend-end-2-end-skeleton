# Настройка окрудения

> этот раздел нужен просто для понимания того как настроить подобную сборку с нуля

## План урока

0. мотивация;
0. требования к уровню читателя;
1. создание проекта и установка зависимостей;
2. настройка конфигурации;
3. запуск простого теста;


## Мотивация

Это первая статья из серии статей посвященных E2E тестированию. Эту серию я начал 
в первую очередь для того чтобы прояснить не то для чего они нужны 
(про это уже много сказано в рунете), а то как их писать, какие есть подходы к проектированию тестов, 
настройки удобной среды для их написания, постараюсь зафиксировать и разобрать сложные моменты. 
Я считаю что важно писать не только unit тесты т.к. это позволяет нам избавится от рутины ручного 
тестирования хотябы частично и поможет повысить качество реализуемого нами продукта. 
Спасибо за внимание.

## Требования к уровню читателя

В первую очередь вы должны владеть языком javascript хотябы на базовом уровне и знать как через js работать 
с DOM деревом, хорошо знать html, уметь работать с npm, и уметь работать с git.

## Требования к софту

Желательно работать на unix системе и в 
 
## Cоздание проекта и установка зависимостей

Для начала необходимо создать директорию для проекта, 
откройте терминал и введите команды, `mkdir nightwatch-example` это созддаст директорию сназванием `nightwatch-example`
и выполните команду `cd nightwatch-example` так в терминале вы перейдете в эту директорию. 

Далее необходимо инициализировать файл в которому в дальнейшем будут записыватся все пакеты проекта, 
для этого выполните команду `npm init` ответте на появившиеся в терминале вопросы и вы увидите в директории `nightwatch-example` 
появится файл `package.json`.

Далее необходимо установить пакеты с которыми мы будем далее работать.

### Установка nightwatch.js

Чтобы установить последнюю версию с помощью npm инструмента командной строки, выполните следующее:

```bash
npm install nightwatch
```

* добавить опцию -g, чтобы сделать nightwatch доступным глобально в вашей системе. Пример: `npm install nightwatch -g`.
* добавить опцию --save-dev, чтобы сохранить nightwatch как devDependency (зависимость для разработки) в вашем package.json. Пример: `npm install nightwatch --save-dev`.

Выполните оба способа установки.

### WebDriver

WebDriver обеспечивает независимый от платформы и языка протокол для удаленного управления браузером, в это входит: 
управление дом элементами, навигацией, браузерными API и управлением пользовательского агента. 
В первую очередь WebDriver  предназначен для автоматизированного тестирования пользовательских сценариев. 
Более подробно можно знакомится в официальной спецификации [WebDriver](https://www.w3.org/TR/webdriver1/).

Вот список доступных на данный момент драйверов для браузеров:

| WebDriver Binary | браузер |
|---|---|
| [ChromeDriver](http://chromedriver.chromium.org/)  | Google Chrome  |
| [GeckoDriver](https://github.com/mozilla/geckodriver/releases)  | FireFox  |
| [SafariDriver](https://developer.apple.com/documentation/webkit/testing_with_webdriver_in_safari)  | Safari  |
| [Microsoft WebDriver](https://developer.microsoft.com/en-us/microsoft-edge/tools/webdriver/)  | Microsoft Edge  |

Нам пока понадобится только ChromeDriver.

### Установка WebDriver

Установка служб WebDriver может быть выполнена либо путем загрузки двоичного файла напрямую, либо с помощью пакета NPM.

### ChromeDriver

ChromeDriver можно загрузить со страницы загрузок [ChromeDriver](http://chromedriver.chromium.org/) . 
Или вы можете использовать пакет NPM chromedriver в качестве зависимости в вашем проекте:

```bash
npm install chromedriver --save-dev
```

## Настройка конфигурации

После того как мы установили все необходимые пакеты приступим к настройке конфигурации для nightwatch.
Создайте в корне проекта файл `nightwatch.json` и поместите в него конфигурацию указанную ниже:

```json
{
  "src_folders" : ["./tests"],  
  "webdriver" : {
    "log_path" : "./log",
    "start_process": true
  },
  "test_settings" : {
    "default" : {
      "webdriver": {
        "port": 9515,
        "server_path": "./node_modules/chromedriver/lib/chromedriver/chromedriver.exe",
        "cli_args": [
          "--verbose"
        ]
      },
      "screenshots" : {
        "enabled" : true,
        "on_failure" : true,
        "on_error" : false,
        "path" : "./reports/screenshots/chrome"
      },
      "desiredCapabilities" : {
        "browserName" : "chrome",
        "loggingPrefs": {
          "driver": "INFO",
          "server": "OFF", 
          "browser": "INFO"
        }
      }
    }
  }
}
```

Давайте разберем основные моменты в конфигурации:

* `src_folders` - список директорий в которых nightwatch будет искать ваши тесты:
* `webdriver` - Объект, содержащий параметры конфигурации, связанные с **WebDriver**
    * `start_process` - Нужно или нет управлять процессом WebDriver автоматически, ставить false если вы запускаете эту службу вручную
    * `log_path` - путь куда будут писатся логи **WebDriver**
    * Про остальные параметры конфиурации можно прочитать в документации [nightwatchjs](http://nightwatchjs.org/gettingstarted#webdriver-settings)
* `test_settings` - Этот объект содержит все параметры, связанные с тестами, и может содержать несколько сред, 
в нашей конфигурации задана среда `default` она будет использована по умолчанию при вызрве в терминале команды `nightwatch`, 
если ее не будет то для запуска тестов необходимо указывать название среды которая будет задействована, например `nightwatch --env=chrome` 
иначе мы получим такую ошибку: `Invalid testing environment specified: default. Available environments are: chrome`. 
    * >Описаные ниже свойства помещаются в объект среды для которой они настраиваются
    * `webdriver` - Объект, содержащий параметры конфигурации, связанные с **WebDriver**, выше я его упомянал
    * `screenshots` - настройки для создания скриншотов
    * `desiredCapabilities` - 	WebDriver, когда будет создан новый сеанс. Вы можете указать имя браузера, например, 
    наряду с другими возможностями. Вот полный список [настроек](https://github.com/SeleniumHQ/selenium/wiki/DesiredCapabilities) 
    
Для более подобного изучения настройки обратитесь к [документации](http://nightwatchjs.org/gettingstarted).
 

## Запуск простого теста

После того как мы установили необходимые пакеты и написали конфигурацию для nightwatch давайте напишем простой тест.

Создайте в проекте директорию с названием `tests` и в ней файл `google.js`. В файл поместите вот этот код:

```js
module.exports = {
  'Demo test Google' : function (browser) {
    browser
      .url('http://www.google.com')
      .waitForElementVisible('body')
      .setValue('input[type=text]', 'nightwatch')
      .waitForElementVisible('input[name=btnK]')
      .click('input[name=btnK]')
      .pause(1000)
      .assert.containsText('#main', 'Night Watch')
      .end();
  }
};
```

И в консоли выполните команду `nightwatch tests/google.js` у вас должно автоматически открытся окно браузера 
там будут выполнены некоторые действия после оно закроется и в консоле появится сообщение `OK. 3 assertions passed.`

Мы подготовили среду для написани E2E тестов и написали свой первый тест. 
В следующих уроках мы более подробно разберемся в том как проектировать и писать E2E тесты.
